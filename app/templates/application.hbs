{{did-insert this.updateCommandList}}
{{did-insert this.updateTimerList}}
{{did-insert this.updateSongList}}
{{did-insert this.updateRequestList}}
{{did-update this.updateCommandList this.commands}}
{{did-update this.updateTimerList this.timers}}
{{did-update this.updateSongList this.songs}}
{{did-update this.updateRequestList this.requests}}
<HeadLayout />
{{#if this.currentUser.hideMenu}}
  {{#unless this.isOverlay}}
    <header class="m-0 p-0" id="headerA" aria-label="overlay only header" role="toolbar" draggable={{true}} {{on "dragstart" this.dragWindow}}  {{on "dragend" this.dropWindow}}>
      <BsNavbar
        @type="dark"
        class="px-0 my-0 py-0 border border-1 border-bottom-0 border-secondary papermenu"
        @backgroundColor="dark"
        @collapsed={{true}}
        @fluid={{true}}
        @position="fixed-top"
        @toggleBreakpoint="md"
        @onCollapse={{fn (mut this.collapsed) true}}
        @container="none container-fluid px-0 ps-2"
        @onExpand={{fn (mut this.collapsed) false}} as |navbar|>
          <div class="navbar-header row col-md-auto col g-0">
            <div class="col-auto">
              <navbar.toggle class="rounded-0 btn btn-outline-dark border-0 py-0 m-0 d-none" />
              <button type="button" class="navbar-brand bg-transparent border-0 p-0 m-0 ps-md-2 ps-2">
                {{svg-jar "papercat-gray-icon" class="logo" }}
                <span class="d-none d-sm-inline-block pe-3">Paperbot Reader</span> 
              </button>{{this.loadConfig}}
            </div>
            <div class="col d-md-none d-flex">
              <button type="button" class="nav-link pt-3 pb-2 w-100 bg-transparent border-0"></button>
            </div>
            <div class="btn-group btn-group-sm col-auto d-md-none">
              {{#if this.isMain}}
                {{#if this.isWinOverlayAllowed}}
                  <button type="button" class="btn btn-outline-info px-3 border-0 rounded-0" title="Show overlay" {{on "click" this.toggleOverlay}}>
                    <FaIcon @icon="list-alt" />
                  </button>
                {{/if}}
                <button type="button" class="btn btn-outline-info px-3 border-0 rounded-0" title="Show lyrics" {{on "click" this.toggleLyrics}}>
                  <FaIcon @icon="align-center" />
                </button>
              {{/if}}            
              <button type="button" class="btn btn-outline-info px-3 border-0 rounded-0" title="{{if this.lightControl.isDark "Switch to light mode" "Switch to dark mode"}}" {{on "click" this.lightControl.toggleMode}}>
                <FaIcon @icon="lightbulb" @prefix={{if this.updateLight "far" "fas"}} />
              </button>
              {{#if this.showSettings}}
                <PbSettings @clients={{this.clients}} @overlays={{this.overlays}} @handleExport={{this.handleExport}} @handleImport={{this.handleImport}} @wipeDatabase={{this.wipeDatabase}} />
              {{/if}}
              <CloudState />
            </div>
            <div class="col-auto d-md-none">
              <button type="button" class="btn btn-outline-secondary border-0 px-0 rounded-0 btn-window" {{on "click" this.minimizeWindow}}><FaIcon @icon="window-minimize" /></button>
              <button type="button" class="btn btn-outline-secondary border-0 px-0 rounded-0 btn-window" {{on "click" this.maximizeWindow}}><FaIcon @icon="window-maximize" /></button>
              <button type="button" class="btn btn-outline-danger border-0 px-0 rounded-0 btn-window" {{on "click" this.closeWindow}}><FaIcon @icon="times" /></button>
            </div>    
          </div>
          <navbar.content class="px-md-0 px-3">
            <navbar.nav class="col" as |nav|>
              <nav.item class="col-md d-md-flex d-none">
                <button type="button" class="nav-link w-100 pt-3 pb-2 bg-dark border-0"></button>
              </nav.item> 
            </navbar.nav>
          </navbar.content>
          <div class="row g-0 d-md-flex col col-md-auto d-none">
            <div class="btn-group btn-group-sm col-auto">
              {{#unless (or this.isOverlay this.isLyrics)}}
                {{#if this.isWinOverlayAllowed}}
                  <button type="button" class="btn btn-outline-info px-3 border-0 rounded-0" title="Show overlay" {{on "click" this.toggleOverlay}}>
                    <FaIcon @icon="list-alt" />
                  </button>
                {{/if}}
                <button type="button" class="btn btn-outline-info px-3 border-0 rounded-0" title="Show lyrics" {{on "click" this.toggleLyrics}}>
                  <FaIcon @icon="align-center" />
                </button>
              {{/unless}}
              <button type="button" class="btn btn-outline-info px-3 border-0 rounded-0" title="{{if this.lightControl.isDark "Switch to light mode" "Switch to dark mode"}}" {{on "click" this.lightControl.toggleMode}}>
                <FaIcon @icon="lightbulb" @prefix={{if this.updateLight "far" "fas"}} />
              </button>
              {{#if this.showSettings}}
                <PbSettings @clients={{this.clients}} @overlays={{this.overlays}} @handleExport={{this.handleExport}} @handleImport={{this.handleImport}} @wipeDatabase={{this.wipeDatabase}} />
              {{/if}}
              <CloudState />
            </div>
            <button type="button" class="btn btn-outline-secondary border-0 p-0 rounded-0 btn-window" {{on "click" this.minimizeWindow}}><FaIcon @icon="window-minimize" /></button>
            <button type="button" class="btn btn-outline-secondary border-0 p-0 rounded-0 btn-window" {{on "click" this.maximizeWindow}}><FaIcon @icon="window-maximize" /></button>
            <button type="button" class="btn btn-outline-danger border-0 p-0 rounded-0 btn-window" {{on "click" this.closeWindow}}><FaIcon @icon="times" /></button>  
          </div>
      </BsNavbar>
    </header>
  {{/unless}}
{{else}}
  <header class="m-0 p-0" id="headerB" aria-label="regular header" role="toolbar" draggable={{true}} {{on "dragstart" this.dragWindow}}  {{on "dragend" this.dropWindow}}>
    <BsNavbar
      @type="dark"
      class="px-0 my-0 py-0 border border-1 border-bottom-0 border-secondary papermenu"
      @backgroundColor="dark"
      @collapsed={{true}}
      @fluid={{true}}
      @position="fixed-top"
      @toggleBreakpoint="md"
      @onCollapse={{fn (mut this.collapsed) true}}
      @container="none container-fluid px-0 ps-md-2"
      @onExpand={{fn (mut this.collapsed) false}} as |navbar|>

        <div class="navbar-header row col-md-auto col g-0">
          <div class="col-auto">
            <navbar.toggle class="rounded-0 btn btn-outline-dark border-0 py-0 m-0 ps-2" />
            <button type="button" class="navbar-brand bg-transparent border-0 p-0 m-0 ps-md-2">
              {{svg-jar "papercat-gray-icon" class="logo" }}
              <span class="d-none d-sm-inline-block pe-3">Paperbot</span> 
            </button>{{this.loadConfig}}
          </div>
          <div class="col d-md-none d-flex">
            <button type="button" class="nav-link pt-3 pb-2 w-100 bg-transparent border-0"></button>
          </div>
          <div class="btn-group btn-group-sm col-auto d-md-none">          
            {{#if this.currentUser.isTauri}}
              {{#unless (or this.isOverlay this.isLyrics)}}
                {{#if this.isWinOverlayAllowed}}
                  <button type="button" class="btn btn-outline-info px-3 border-0 rounded-0" title="Show overlay" {{on "click" this.toggleOverlay}}>
                    <FaIcon @icon="list-alt" />
                  </button>
                {{/if}}
                <button type="button" class="btn btn-outline-info px-3 border-0 rounded-0" title="Show lyrics" {{on "click" this.toggleLyrics}}>
                  <FaIcon @icon="align-center" />
                </button>
              {{/unless}}
            {{/if}}
            <button type="button" class="btn btn-outline-info px-3 border-0 rounded-0" title="{{if this.lightControl.isDark "Switch to light mode" "Switch to dark mode"}}" {{on "click" this.lightControl.toggleMode}}>
              <FaIcon @icon="lightbulb" @prefix={{if this.updateLight "far" "fas"}} />
            </button>
            {{#if this.showSettings}}
              <PbSettings @clients={{this.clients}} @overlays={{this.overlays}} @handleExport={{this.handleExport}} @handleImport={{this.handleImport}} @wipeDatabase={{this.wipeDatabase}} />
            {{/if}}
            <CloudState />

          </div>          
          {{#if this.currentUser.isTauri}}
            <div class="col-auto d-md-none">
              <button type="button" class="btn btn-outline-secondary border-0 p-0 rounded-0 btn-window" {{on "click" this.minimizeWindow}}><FaIcon @icon="window-minimize" /></button>
              <button type="button" class="btn btn-outline-secondary border-0 p-0 rounded-0 btn-window" {{on "click" this.maximizeWindow}}><FaIcon @icon="window-maximize" /></button>
              <button type="button" class="btn btn-outline-danger border-0 p-0 rounded-0 btn-window" {{on "click" this.closeWindow}}><FaIcon @icon="times" /></button>
            </div>
          {{/if}}
        </div>
        <navbar.content class="px-md-0 px-3">
          <navbar.nav class="col" as |nav|>
            <nav.item>
              <nav.link-to @route="streams.index" class="py-1">Streams</nav.link-to>
            </nav.item>
            <nav.item>
              <nav.link-to @route="commands.index" class="py-1">Commands</nav.link-to>
            </nav.item>
            <nav.item>
              <nav.link-to @route="timers.index" class="py-1">Timers</nav.link-to>
            </nav.item> 
            <nav.item>
              <nav.link-to @route="songs.index" class="py-1">Songs</nav.link-to>
            </nav.item>
            <nav.item>
              <nav.link-to @route="clients.index" class="py-1">Clients</nav.link-to>
            </nav.item>
            <nav.item>
              <nav.link-to @route="overlays.index" class="py-1">Overlays</nav.link-to>
            </nav.item>            
            {{#unless this.currentUser.isTauri}}
              <nav.item>
                <nav.link-to @route="reader" class="py-1"><FaIcon @icon="align-center" /></nav.link-to>
              </nav.item>
              <nav.item>
                <nav.link-to @route="overlay" target="_blank" class="py-1"><FaIcon @icon="list-alt" /></nav.link-to>
              </nav.item>              
            {{/unless}}
            <nav.item>
              <PbFirstRun />
            </nav.item>
            <nav.item class="col-md d-md-flex d-none">
              <button type="button" class="nav-link w-100 pt-3 pb-2 bg-transparent border-0"></button>
            </nav.item> 
          </navbar.nav>
        </navbar.content>
        <div class="row g-0 d-md-flex col col-md-auto d-none">
          <div class="btn-group btn-group-sm col-auto">
            {{#if this.currentUser.isTauri}}
              {{#if this.isMain}}
                {{#if this.isWinOverlayAllowed}}
                  <button type="button" class="btn btn-outline-info px-3 border-0 rounded-0" title="Show overlay" {{on "click" this.toggleOverlay}}>
                    <FaIcon @icon="list-alt" />
                  </button>
                {{/if}}
                <button type="button" class="btn btn-outline-info px-3 border-0 rounded-0" title="Show lyrics" {{on "click" this.toggleLyrics}}>
                  <FaIcon @icon="align-center" />
                </button>
              {{/if}}
            {{/if}}
            <button type="button" class="btn btn-outline-info px-3 border-0 rounded-0" title="{{if this.lightControl.isDark "Switch to light mode" "Switch to dark mode"}}" {{on "click" this.lightControl.toggleMode}}>
              <FaIcon @icon="lightbulb" @prefix={{if this.updateLight "far" "fas"}} />
            </button>
            {{#if this.showSettings}}
              <PbSettings @clients={{this.clients}} @overlays={{this.overlays}} @handleExport={{this.handleExport}} @handleImport={{this.handleImport}} @wipeDatabase={{this.wipeDatabase}} />
            {{/if}}
            
            <CloudState />
          </div>
          {{#if this.currentUser.isTauri}}
            <button type="button" class="btn btn-outline-secondary border-0 p-0 rounded-0 btn-window" {{on "click" this.minimizeWindow}}><FaIcon @icon="window-minimize" /></button>
            <button type="button" class="btn btn-outline-secondary border-0 p-0 rounded-0 btn-window" {{on "click" this.maximizeWindow}}><FaIcon @icon="window-maximize" /></button>
            <button type="button" class="btn btn-outline-danger border-0 p-0 rounded-0 btn-window" {{on "click" this.closeWindow}}><FaIcon @icon="times" /></button>
          {{/if}}
        </div>
    </BsNavbar>
  </header>
{{/if}}
{{#if this.isOverlay}}
  <style>
    .chroma { background-color: {{this.globalConfig.config.chromaColor}}!important; }
    html, body { overflow: hidden!important; }
  </style>
  <main class="container-fluid px-0 border border-0 border-transparent bg-secondary chroma" draggable={{true}} {{on "dragstart" this.dragWindow}}  {{on "dragend" this.dropWindow}} title="Press alt+F4 if you want to close this window." id="mainA" role="button">
    <BsTooltip @delayHide="0" role="presentation">
      Press alt+F4 if you want to close this window.
    </BsTooltip>
    {{outlet}}
  </main>
{{else}}
  <main class="container-fluid pt-custom px-0 alert-secondary border border-secondary bg-secondary border-1" id="mainB">
    {{outlet}}
  </main>
{{/if}}