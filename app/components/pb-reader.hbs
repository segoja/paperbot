{{did-insert this.setActiveSong}}
{{did-update this.setActiveSong this.queueHandler.pendingSongs}}
{{did-update this.setActiveSong this.selected}}

<div class="row h-100 flex-fill m-0 p-0">
  <div class="col-12 h-100 flex-fill p-0 m-0"> 
      {{!-- song listing --}}
      <div class="card h-100 flex-fill rounded-0">
        <div class="card-header px-2">
          <div class="row g-1">
            <div class="col">
              <PowerSelect @searchEnabled={{true}} @search={{this.searchSong}} @searchMessage="" @options="" @searchPlaceholder="Type a song" @selected={{this.selected}}  @searchClass="form-control w-100"  @allowClear={{true}} @onChange={{this.selectSong}} @placeholder="Select a song" as |song|>
                <span>{{song.title}} {{#if song.artist}}- <span class="text-secondary">{{song.artist}}</span>{{/if}}</span>
              </PowerSelect>
            </div>
            <div class="col-auto">
              <BsButton @type="secondary" @onClick={{this.autoAdjust}}>
                <FaIcon @icon={{if this.calculating "spinner" "wand-magic-sparkles"}} @spin={{this.calculating}} />
              </BsButton>               <button type="button" class={{if this.currentSong.viewMode "btn btn-primary" "btn btn-secondary"}} {{on "click" this.modeSwitch}} alt="formatted text"><FaIcon @icon="paragraph" /></button>
              <div class="btn-group">
                <button type="button" class="btn btn-secondary" {{on "click" this.downKey}} alt="transpose down"><FaIcon @icon="down-long" /></button>
                <span class="btn btn-secondary disabled text-white">{{this.currentSong.transSteps}}</span>
                <button type="button" class="btn btn-secondary" {{on "click" this.upKey}} alt="transpose up"><FaIcon @icon="up-long" /></button>
              </div>
              <div class="btn-group">
                <button type="button" class="btn btn-secondary" {{on "click" this.resetZoom}} alt="Reset zoom"><FaIcon @icon="undo" /></button>
                <button type="button" class="btn btn-secondary" {{on "click" this.subZoom}} alt="Zoom out"><FaIcon @icon="search-minus" /></button>
                <button type="button" class="btn btn-secondary" {{on "click" this.addZoom}} alt="Zoom in"><FaIcon @icon="search-plus" /></button>
              </div>
              <div class="btn-group">
                <button type="button" class="btn btn-secondary {{if (eq this.currentSong.columns 0) "active"}}" {{on "click" this.autoColumn}} alt="Auto columns">
                  <FaIcon @icon="columns" /> 
                  {{if (gt this.currentSong.columns 0) this.currentSong.columns}}
                </button>
                <button type="button" class="btn btn-secondary px-1" {{on "click" this.lessColumn}} alt="Less columns"><FaIcon @icon="minus" /></button>
                <button type="button" class="btn btn-secondary px-1" {{on "click" this.moreColumn}} alt="More columns"><FaIcon @icon="plus" /></button>
              </div>
              <BsButton @type={{if this.saving "success" "secondary"}} disabled={{not this.currentSong.hasDirtyAttributes}} @onClick={{this.doneEditing}}>
                <FaIcon @icon="save" @pulse={{this.saving}} />
              </BsButton>             
            </div>
          </div>
        </div>
        <div class="card-body mx-0 p-0 flex-fill h-100 overflow-hidden" id="bodycontainer">
          <div class="row m-0 flex-fill mh-100 listframe-reader">
              {{#if this.restore}}
                {{#if this.currentSong}}
                  <h5>{{this.currentSong.title}}</h5>
                  <style>
                    .fancy-columns-pre,
                    .fancy-columns {
                      font-size: {{this.currentSong.zoomLevel}}em; 
                      column-count: {{this.currentSong.columns}};
                    }   
                  </style>
                  {{#if this.currentSong.viewMode}} 
                    <div class="fancy-columns">
                      {{chord-parser this.currentSong.lyrics key=0 mode=this.currentSong.viewMode}}
                    </div>
                  {{else}}
                    <div class="fancy-columns-pre">
                      {{this.currentSong.lyrics}}
                    </div>
                  {{/if}}
                {{/if}}
              {{else}}
                Reloading...
              {{/if}}
          </div>
        </div>
        <div class="card-footer py-0 my-0 px-2">
        </div>
      </div>
  </div>
</div>