{{#if @isEditing}}
  <div class="card-body listframe">
    <BsForm @formLayout="horizontal" @model={{@stream}} @onSubmit={{this.doneAndReturnEditing}} as |form|>
      <form.element @controlType="text" @label="Stream Title" class="pb-2" placeholder="Stream title" @property="title" required />
      <form.element @controlType="text" @label="Stream Channel" class="pb-2" placeholder="Stream channel" @property="channel" required />
      
      <div class="form-group row pb-2">
        <label class="col-md-4">Stream Monitoring</label>
        <div class="col-sm">
          <form.element @controlType="checkbox" @label="Chat Logging" @formLayout="inline" @property="savechat" class="form-check form-check-inline ps-0"  />
          <form.element @controlType="checkbox" @label="Event Logging" @formLayout="inline" @property="events"class="form-check form-check-inline" as |checkbox|>
            <checkbox.control disabled={{this.globalCOnfig.config.canGetEvents}} />
          </form.element>
          <form.element @controlType="checkbox" @label="Song Request System" @formLayout="inline" @property="requests" class="form-check form-check-inline"  />
        </div>
      </div>    
      <form.element @controlType="power-select" class="pb-2" @property="botclient" @label="Bot Client" @options={{@clients}} selected={{this.globalConfig.config.defbotclient}} @onChange={{@setBotClient}} required as |client|>
        <client.control @allowClear={{true}} @placeholder="Select the Bot Client for the stream" as |option|>
          {{option.username}}
        </client.control>
      </form.element> 
      <form.element @controlType="power-select" class="pb-2" @property="chatclient" @label="Chat Client" @options={{@clients}} selected={{this.globalConfig.config.defchatclient}}  @onChange={{@setChatClient}}  required as |client|>
        <client.control @allowClear={{true}} @placeholder="Select the Chat Client for the stream" as |option|>
          {{option.username}}
        </client.control>
      </form.element>
    </BsForm>
  </div>
  <div class="card-footer py-3 bg-transparent">
    <div class="row">
      <div class="col">
        <ButtonConfirm @btnClass="btn btn-danger" @btnIcon="trash" @btnText="Delete" @confirmDescription="Are you sure you want to delete this stream?" @targetAction={{@deleteStream}} />
      </div>
      <div class="col-auto">
        <BsButton @type="secondary" {{on "click" @returnStream}}><FaIcon @icon="right-to-bracket" @flip="horizontal"  /><span class="d-none d-md-inline"> Back</span></BsButton>
        <BsButton @type={{if this.saving "success" "secondary"}} class="d-none d-md-inline" @onClick={{this.doneEditing}}>
          <FaIcon @icon="save" @pulse={{this.saving}} />
        </BsButton>
        <BsButton @type="success" @onClick={{this.doneAndReturnEditing}}><FaIcon @icon="save" /> Save<span class="d-none d-md-inline"> & Return</span></BsButton>   
      </div>
    </div>      
  </div>
{{else}}
  <div class="card-body p-0 stream-menu">
    <div class="row g-0 bg-dark">
      {{#if this.currentUser.isTauri}}
        <BsButton class="btn-sm col-auto col-sm-auto border rounded-0" @type={{if this.audio.SBstatus "warning" "secondary"}} @onClick={{this.audio.toggle}} title="Enable/disable soundboard">
          {{on-key "ctrl+KeyM" this.audio.toggle}}  
          <FaIcon @icon={{if this.audio.SBstatus "volume-up" "volume-mute"}} /> Soundboard
        </BsButton>
      {{/if}}
      <div class="col">
        <div class="row g-0">  
          <BsButton class="btn-sm col-12 col-sm border rounded-0 px-1 py-1 m-0" @type={{if @stream.requests (if this.currentUser.updateQueueOverlay "info" "secondary") "secondary"}} @onClick={{this.queueWriter}} title="Enable/disable queue overlay">
            {{#if @stream.requests}} {{on-key "ctrl+KeyN" this.queueWriter}} {{/if}}
            {{#unless @stream.requests}}
              <BsTooltip @delayHide={{this.globalConfig.ttdelay}}>Please, enable the <em>Song Request System</em></BsTooltip>
            {{/unless}}
            <FaIcon @icon={{if @stream.requests (if this.currentUser.updateQueueOverlay "file-alt" "file") "file"}} /> Requests
          </BsButton>          
          {{#if this.disableBotButton}}
            <BsButton class="btn-sm col-12 col-sm border rounded-0 text-truncate" @type={{if this.twitchChat.botConnected "primary" "secondary"}} disabled={{this.disableBotButton}}><FaIcon @icon="play" /> {{if this.twitchChat.botConnected "Disconnect" "Connect"}}</BsButton>
          {{else}}      
            <BsButton class="btn-sm col-12 col-sm border rounded-0 text-truncate" disabled={{unless (or this.optsbot this.twitchChat.botConnected) true}} @type={{if this.twitchChat.botConnected "primary" "secondary"}} @onClick={{fn (if this.twitchChat.botConnected this.disconnectClients this.connectBot)}}>
              <FaIcon @icon={{if this.twitchChat.botConnected "stop" "play"}} /> {{if this.twitchChat.botConnected "Disconnect" "Connect"}}
            </BsButton>
          {{/if}}
        </div>
      </div>
      <div class="col">
        <div class="row g-0"> 
          <BsButton class="btn-sm col-12 col-sm text-truncate border rounded-0" @type="danger" @onClick={{this.finishStream}} disabled={{if this.twitchChat.botConnected false (if @stream.finished this.disconnectButton true)}}><FaIcon @icon="flag-checkered" /> Stop & Save</BsButton>
          <BsButton class="btn-sm col col-sm text-editstream text-truncate border rounded-0" @type="warning" @onClick={{@editStream}}><FaIcon @icon="edit" /> Edit Stream</BsButton>
        </div>
      </div>
      <div class="col-auto">
        <div class="row g-0 h-100">
          {{!-- <BsButton class="btn-sm col-12 col-sm border rounded-0 ps-0 pe-1 py-0 m-0 h-50 h-sm-100" @type={{if this.globalConfig.config.cpanevents "success pe-1" "secondary"}} @onClick={{this.toggleEvents}} title="Stream events" disabled={{not (and this.twitchChat.botConnected @stream.events)}}>
            <FaIcon @icon={{if this.globalConfig.config.cpanevents "angle-right" "angle-left"}} class="mx-1 align-middle" />
            <span class="setlist-btn-text">|||||</span>
          </BsButton> --}}
          <BsButton class="btn-sm col-12 col-sm border rounded-0 h-100 ps-2 pe-3" @type={{if this.globalConfig.config.cpansetlist "info" "secondary"}} @onClick={{this.toggleSetlist}} title="Setlist/queue manager" disabled={{not (and this.twitchChat.botConnected @stream.requests)}}>
            <div class="row g-0">
              <div class="col-auto">
                {{svg-jar (if this.globalConfig.config.cpansetlist "setlist-close" "setlist-open") class="setlist-icon align-middle" }}
                {{#unless this.globalConfig.config.cpansetlist}}
                  {{#if (and this.queueHandler.pendingSongs this.twitchChat.botConnected)}}
                    <span class="position-relative placeholder-glow">
                      <small class="position-absolute top-0 start-100 translate-middle badge p-1 pt-0 bg-danger placeholder">
                        {{this.queueHandler.pendingSongs.length}}
                      </small>
                    </span>
                  {{/if}}
                {{/unless}}
              </div>
            </div>  
          </BsButton>
        </div>
      </div>
    </div>
    {{#unless @stream.finished}}
      {{#if this.currentUser.isTauri}}
        <SoundboardLoading />
      {{/if}}
    {{/unless}}
  </div>
  {{#unless @stream.finished}}
    {{#if this.twitchChat.botConnected}}
      <div class="card-body p-0 m-0 flex-fill d-flex h-100 overflow-hidden">
        <div class="row flex-fill d-flex h-100 g-0 overflow-hidden">
          <div class="col h-100 border-0 border-top m-0 p-0 position-relative w-effects">
            <div class="row m-0 p-0 {{if @stream.events (if this.globalConfig.config.cpanevents (if this.globalConfig.config.cpanmessages "h-35" "h-full-events")) "d-none"}} border h-effects">
              <div class="col h-100 border m-0 p-0 overflow-hidden h-effects">
                <PbStreamEditEvents @stream={{@stream}} />
              </div>
            </div>
            <div class="row m-0 p-0 {{if @stream.events (if this.globalConfig.config.cpanevents "h-65" "h-full-chat") "h-100"}} border h-effects">
              <div class="col h-100 border m-0 p-0 overflow-hidden h-effects">
                <PbStreamEditChat @stream={{@stream}} />
              </div>
            </div>
          </div>
          {{#if @stream.requests}}
            {{on-key "ctrl+Period" this.queueHandler.nextSong}}
            {{on-key "ctrl+Comma" this.queueHandler.prevSong}}
            {{on-key "ctrl+KeyQ" this.queueHandler.modPressed event="keypress"}} 
            {{on-key "ctrl+KeyQ" this.queueHandler.modNotPressed event="keyup"}}
          {{/if}}
          {{#if @stream.requests}}
            <div class={{if this.globalConfig.config.cpansetlist "d-none d-md-block col-md-6 col-lg-4 h-100 border m-0 p-0 w-effects" "d-none w-effects"}}>
              <PbSongsSetlist @isStream={{true}} />
            </div>
            <div class="d-md-none offcanvas {{if this.globalConfig.config.cpansetlist "show" "hiding"}} offcanvas-end pt-offc-custom-stream border-0 bg-transparent w-100 w-sm-75 w-md-50 w-effects px-0" data-bs-backdrop="true" data-bs-scroll="true" data-bs-toggle="offcanvas">
              <PbSongsSetlistOffc @toggleSetlist={{this.toggleSetlist}} @isStream={{true}} />
            </div>
          {{/if}}
        </div>
      </div>
    {{/if}}
  {{/unless}}
{{/if}}
