{{#if @isEditing}}
  <div class="card-body">
    <BsForm @formLayout="horizontal" @model={{@stream}} @onSubmit={{fn this.doneEditing}} as |form|>
      <form.element @controlType="text" @label="Stream Title" placeholder="Stream title" @property="title" required />
      <form.element @controlType="text" @label="Stream Channel" placeholder="Stream channel" @property="channel" required />
      
      <form.element @controlType="checkbox" @label="Request System" @property="requests" />
      
      <form.element @controlType="power-select" @property="botclient" @label="Bot Client" @options={{@clients}} required as |client|>
        <client.control as |option|>
          {{option.username}}
        </client.control>
      </form.element>
      <form.element @controlType="power-select" @property="chatclient" @label="Chat Client" @options={{@clients}} required as |client|>
        <client.control as |option|>
          {{option.username}}
        </client.control>
      </form.element>  
      
      <BsButton type="submit" @type="success">Save</BsButton>
      <BsButton @type="danger" @onClick={{fn @deleteStream}}>Delete</BsButton>
    </BsForm>
  </div>
{{else}}
  <div class="card-body p-0 m-0 border-top-0 border-light">
    <div class="row p-0 m-0 border border-dark rounded-0 border-dark bg-dark">
      <BsButton @class="btn-sm border border-dark col-sm-auto" @type="warning rounded-0" @onClick={{fn this.soundboardToggle}} disabled={{if this.disconnectButton true @stream.finished}}>
        <FaIcon @icon="{{if this.soundBoardEnabled "volume-up" "volume-mute"}}" />
      </BsButton>          
      <BsButton @class="btn-sm border border-dark col-sm" @type="info" @onClick={{fn this.connectBot}} disabled={{this.disableBotButton}}>Connect Bot Client</BsButton>
      <BsButton @class="btn-sm border border-dark col-sm" @type="secondary" @onClick={{fn this.connectChat}} disabled={{this.disableChatButton}}>Connect Chat Client</BsButton>
      <BsButton @class="btn-sm border border-dark col-sm" @type="danger" @onClick={{fn this.disconnectClients}} disabled={{this.disconnectButton}}>Disconnect Bot & Chat</BsButton>
      <BsButton @class="btn-sm border border-dark col-sm" @type="success rounded-0" @onClick={{fn this.finishStream}} disabled={{if this.twitchChat.botConnected false @stream.finished}}>Finish Stream</BsButton>      
    </div>
  </div>
  {{#unless @stream.finished}}  
    {{#if this.twitchChat.botConnected}}
      <div class="card-body p-0 m-0 flex-fill d-flex h-100 overflow-hidden">
        <EmberDragula class="row flex-fill d-flex h-100 mx-0 px-0 overflow-hidden" as |d|>
          <div role="button" class="h-100 d-flex border alert-secondary" {{on "click" this.toggleExtraPanLeft}}><span class="h-75 border border-secondary align-self-center"></span></div>
          {{#if this.extraPanLeft}}
            <d.Container class="col h-100 border m-0 p-0">
            </d.Container>
          {{/if}}
          <d.Container class="col h-100 border m-0 p-0">
            <div id="chat" class="row {{unless this.cpanmessages "h-100 dragpanel"}} overflow-hidden border border  m-0 p-0">            
              <div class="col {{unless this.cpanmessages "h-100"}} flex-column flex-fill d-flex overflow-hidden">
                <div class="row  bg-secondary text-light">
                  <div class="col d-block align-self-center pr-0 pl-3"><h6 class="my-0">Recent messages</h6></div>
                  <BsButtonGroup class="col-auto px-0" as |bg|>
                    <bg.button @type="secondary btn-sm rounded-0 border-0" @onClick={{fn this.togglePan "messages"}} ><FaIcon @icon="{{if this.cpanmessages "window-maximize" "window-minimize"}}" /></bg.button>
                  </BsButtonGroup>
                </div>
                <BsCollapse class="row h-100 overflow-hidden" @collapsed={{this.cpanmessages}}>
                  <div class="col-md-12 chatframe" {{scroll-position this.scrollPosition relative=true}}>
                    {{#each this.messages as |message|}}
                      <div class="row" id="{{message.id}}">
                        <div class="col chatline py-2 {{if message.reward "highlight alert-warning"}}">
                          {{message-format message}}
                        </div>
                      </div>
                    {{/each}}
                  </div>  
                </BsCollapse>  
              </div>
            </div>
          </d.Container>
          <d.Container class="{{if this.requests "col-5" "col-auto"}} h-100 border  m-0 p-0">
         {{#if this.requests}}
              <div id="pending" class="row {{unless this.cpanpending "h-50 dragpanel"}} overflow-hidden border border m-0 p-0">            
                <div class="col {{unless this.cpanpending "h-100"}} flex-column flex-fill d-flex overflow-hidden ">
                  <div class="row bg-secondary text-light">
                    <div class="col d-block align-self-center pr-0 pl-3"><h6 class="my-0">Songs pending</h6></div>
                    <BsButtonGroup class="col-auto px-0" as |bg|>
                      <bg.button @type="secondary btn-sm rounded-0 border-0" @onClick={{fn this.togglePan "pending"}} ><FaIcon @icon="{{if this.cpanpending "window-maximize" "window-minimize"}}" /></bg.button>
                    </BsButtonGroup>
                  </div>
                  <BsCollapse class="row h-100 overflow-hidden" @collapsed={{this.cpanpending}}>
                    <div class="col-md queueframe" {{scroll-position this.scrollPendingPosition relative=false}}>
                      {{#each this.pendingSongs as |pendingsong|}}
                        <div role="button" {{on "click" (fn this.requestStatus pendingsong)}} class="alert-info d-flex flex-column w-100 text-decoration-none py-0 px-2 my-1">
                          <div class="row">
                            <div class="col"><small>{{moment-format pendingsong.timestamp "YYYY/MM/DD HH:mm:ss"}}</small></div>
                            <div class="col-auto"><small>{{pendingsong.user}}</small></div>
                          </div>
                          <div class="alert-heading h6 {{if pendingsong.processed "processed"}}">{{pendingsong.song}}</div>
                        </div>
                      {{/each}}
                    </div>  
                  </BsCollapse>  
                </div>
              </div>

              <div id="played" class="row {{unless this.cpanplayed "h-50 dragpanel"}} overflow-hidden border border m-0 p-0">            
                <div class="col {{unless this.cpanplayed "h-100"}} flex-column flex-fill d-flex overflow-hidden ">
                  <div class="row bg-secondary text-light">
                    <div class="col d-block align-self-center pr-0 pl-3"><h6 class="my-0">Songs played</h6></div>
                    <BsButtonGroup class="col-auto px-0" as |bg|>
                      <bg.button @type="secondary btn-sm rounded-0 border-0" @onClick={{fn this.togglePan "played"}} ><FaIcon @icon="{{if this.cpanplayed "window-maximize" "window-minimize"}}" /></bg.button>
                    </BsButtonGroup>
                  </div>
                  <BsCollapse class="row h-100 overflow-hidden" @collapsed={{this.cpanplayed}}>
                    <div class="col-md queueframe" {{scroll-position this.scrollPlayedPosition relative=false}}>
                      {{#each this.playedSongs as |playedsong|}}
                        <div role="button" {{on "click" (fn this.requestStatus playedsong)}} class="alert-light border-light border d-flex flex-column text-decoration-none py-0 px-2 my-1">
                          <div class="row">
                            <div class="col"><small>{{moment-format playedsong.timestamp "YYYY/MM/DD HH:mm:ss"}}</small></div>
                            <div class="col-auto"><small>{{playedsong.user}}</small></div>
                          </div>
                          <div class="alert-heading h6 {{if playedsong.processed "processed"}}">{{playedsong.song}}</div>
                        </div>
                      {{/each}}
                    </div>  
                  </BsCollapse>
                </div>      
              </div>
          {{/if}}
          </d.Container>
          {{#if this.extraPanRight}}
            <d.Container class="col h-100 border m-0 p-0">
            </d.Container>
          {{/if}}
          <div role="button" class="h-100 d-flex border alert-secondary" {{on "click" this.toggleExtraPanRight}}><span class="h-75 border border-secondary align-self-center"></span></div>
        </EmberDragula>
      </div>
    {{/if}}
    {{#unless this.disconnectButton}}  
      <div class="card-footer flex-column flex-fill d-flex px-1 py-1 my-0"> 
        <div class="row my-0">
          <BsForm @formLayout="vertical" @model={{this}} class="col-md-12 my-0" @onSubmit={{fn this.sendMessage}} as |form|>
            <form.element @property="message" class="my-0 py-0" as |el|>
              <el.control 
                @controlType="text"
                placeholder="Type your message here"
                 class="my-0 py-0"
                readonly={{this.inputDisabled}}        
              />
            </form.element>
          </BsForm>
        </div>      
      </div>
    {{/unless}}
  {{/unless}}
{{/if}}
