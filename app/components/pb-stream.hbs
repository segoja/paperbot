<div class="card {{unless @isEditing "h-100 flex-fill"}} mb-0">
  <div class="card-header bg-dark text-white row p-0 m-0 border-0 rounded-top">
    <div class="col d-block align-self-center pr-0 pl-3"><h5 class="my-0 text-truncate">{{@stream.title}} <small class="muted">({{format-date @stream.date}})</small></h5></div>
    <BsButtonGroup class="col-auto px-0 rounded" as |bg|>
      {{#unless @isEditing}}
        <bg.button @type="dark rounded-0 border-0" @onClick={{fn this.reloadStream}}><FaIcon @icon="redo-alt" /></bg.button>
      {{/unless}}
      <bg.button @type="dark rounded-0 border-0" @onClick={{fn @editStream}} disabled={{@isEditing}} ><FaIcon @icon="edit" /></bg.button>
      <bg.button @type="dark rounded-0 rounded-top-right border-0" @onClick={{fn @closeStream}}><FaIcon @icon="times" /></bg.button>
    </BsButtonGroup>
  </div>
  {{#if this.restore}}
    <PbStreamEdit @stream={{@stream}} @clients={{@clients}} @commands={{@commands}} @isEditing={{@isEditing}} @editStream={{@editStream}} @saveStream={{@saveStream}} @saveAndReturnStream={{@saveAndReturnStream}} @deleteStream={{@deleteStream}} />
  {{/if}}
  {{#unless @isEditing}}
    {{#if @stream.finished}}
      <div class="card-body p-0 m-0  h-100 flex-column d-flex flex-fill overflow-hidden">
        <div class="row p-0 m-0 h-100 d-flex flex-fill overflow-hidden">
          <div class="col-md h-100 flex-column d-flex overflow-hidden border border-round">
            <div class="row alert-dark">
              <div class="col d-block align-self-center pr-0 pl-3"><h6 class="my-0">Chat log</h6></div>
            </div>
            <div class="row h-100 overflow-hidden">
              <div class="col chatframe">
                {{#each @stream.chatlog as |message|}}
                  <div class="row" id="{{message.id}}">
                    <div class="col chatline py-2 {{if message.reward "highlight alert-warning"}}">
                      {{message-format message}}
                    </div>
                  </div>
                {{/each}}
              </div>
            </div>
          </div>
          {{#if @stream.requests}}
            <div class="col-5 h-100 flex-column d-flex overflow-hidden border border-round">
              <div class="row alert-dark">
                <div class="col d-block align-self-center pr-0 pl-3"><h6 class="my-0">Request list</h6></div>
              </div>
              <div class="row h-100 overflow-hidden">
                <div class="col-md queueframe">
                  {{#each @stream.songqueue as |song|}}
                    <div class="alert-light d-flex flex-column w-100 text-decoration-none py-0 px-2 my-1">
                      <div class="row">
                        <div class="col"><small>{{moment-format song.timestamp "YYYY/MM/DD HH:mm:ss"}}</small></div>
                        <div class="col-auto"><small>{{song.user}}</small></div>
                      </div>
                      <div class="alert-heading h6 {{if song.processed "processed"}}">{{song.song}}</div>
                    </div>
                  {{/each}}
                </div>  
              </div>  
            </div>
          {{/if}}
        </div>
      </div>
    {{/if}}
  {{/unless}}
</div>
