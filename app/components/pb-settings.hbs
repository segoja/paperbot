<button type="button" class="btn btn-outline-info px-3 border-0 rounded-0"  {{on "click" this.toggleModal}}><FaIcon @icon="wrench" @class={{if this.cloudState.cloudError "blinkcolor" (if this.cloudState.online "connected")}} /></button>
{{#if this.globalConfig.config}}
    <BsModal @onSubmit={{this.generateSongs}} @open={{this.isViewing}} @scrollable={{true}} @size="lg" as |Modal|>
      <Modal.header @closeButton={{false}} class="p-0 m-0 w-100 border-0 rounded">
        <div class="row g-0 w-100 bg-dark bg-gradient border-0 rounded-top">
          <div class="col py-1 ps-3"><span class="h5 text-white">Settings</span></div>
          <div class="col-auto">
            <button type="button" class="btn btn-dark rounded-0 rounded-top-right border-0" {{on "click" this.toggleModal}}><FaIcon @icon="times" /></button>
          </div>
        </div>
      </Modal.header>
      <Modal.body>
        <BsForm @formLayout="horizontal" @model={{this.globalConfig.config}}  @onSubmit={{this.doneEditing}} as |form|>
          <form.element @controlType="text" @label="Default channel (name)" class="pb-2" placeholder="Default channel name" @property="defchannel" required />
          
          <div class="row pb-2">
            <div class="col-form-label col-md-4">
              <label class="control-label" >External event tracking</label>
              <span role="button" id="external-api-info">
                <FaIcon @icon="question-circle" class="text-info" role="presentation" />
              </span>
              <BsPopover @triggerEvents="click" @triggerElement="#external-api-info" @delayHide={{this.globalConfig.ttdelay}} class="ppover" as |po|>
                <div role="dialog" class="p-2 alert alert-dismissible m-0" {{on "mouseleave" po.close}}>
                  <p class="my-0">Get your Socket API Token from <a href="https://streamlabs.com/dashboard#/apisettings" target="_blank" rel="noopener noreferrer" {{on "click" po.close}}>Streamlabs</a> or <a href="https://streamelements.com/dashboard/account/channels"  target="_blank" rel="noopener noreferrer" {{on "click" po.close}}>StreamElements</a></p>
                </div>
              </BsPopover>
            </div>
            <div class="col-md-8 border-light">
              <div class="row input-group g-0">
                <form.element @controlType="password" @label="" placeholder="Default channel name" @formLayout="inline" @property="externaleventskey" class="col rounded-0 rounded-start" />
                <form.element @controlType="radio" @label="" @options={{this.externalEventServices}} @property="externalevents" @formLayout="inline" class="input-group-text col py-1 rounded-0 rounded-end" as |el|>
                  <el.control @inline={{true}}/>
                </form.element>
              </div>
            </div>
          </div>

          <div class="row pb-2">
            <div class="col-form-label col-md-4">
              <label class="control-label">Default Bot client</label>
              <span role="button" id="clients-info">
                <FaIcon @icon="question-circle" class="text-info" role="presentation" />
              </span>
              <BsPopover @triggerEvents="click" @triggerElement="#clients-info"  @delayHide={{this.globalConfig.ttdelay}} class="ppover" as |po|>
                <div role="dialog" class="p-2 alert alert-dismissible m-0" {{on "mouseleave" po.close}}>
                  <p class="my-0">To set a client you need to add clients <LinkTo @route="clients.index" {{on "click" po.close}}>here</LinkTo></p>
                </div>
              </BsPopover>
            </div>
              <form.element @controlType="power-select" @property="defbotclient" @onChange={{this.setdefBot}} @formLayout="inline" class="col-md-8 border-light" @invisibleLabel={{true}} @options={{@clients}} required as |client|>
                <client.control @allowClear={{true}} @placeholder="Select the default Bot Client for new streams" as |option|>
                  {{option.username}}
                </client.control>
              </form.element>
          </div>

          <div class="row">
            <label class="control-label col-form-label col-md-4">
              Queue overlay
            </label>
            <div class="col-md-8 border-light">
              <div class="row input-group g-0">
                <form.element @controlType="power-select" @property="overlayType" @onChange={{fn (mut this.globalConfig.config.overlayType)}} @formLayout="inline" class="col border-light pb-2" @allowClear={{true}} @options={{this.overlayTypes}} required as |type|>
                  <type.control @placeholder="Select overlay type you want to use" as |option|>
                    {{option}}
                  </type.control>
                </form.element>
              </div>
              <style>
                .pickedColor{ 
                  background-color: {{this.globalConfig.config.chromaColor}}!important; 
                  color: {{this.globalConfig.config.chromaColor}}!important; 
                }
                .pickedColor strong {
                  filter: invert(100%) saturate(200%) grayscale(100%);                          
                }
              </style>
              {{#if (eq this.globalConfig.config.overlayType "file")}}
                <form.element @controlType="text" @formLayout="inline" @property="overlayfolder" class="pb-2" @label="Folder to place queue overlay file" as |el|>
                  <div class="input-group">
                    <el.control disabled class="border-form-control text-secondary" />
                    <div class="input-group-append">
                      <BsButton @type="secondary rounded-0 rounded-end" @onClick={{fn this.opendialogfiles this.globalConfig.config}} >Select folder</BsButton>
                    </div>
                  </div>
                </form.element>
                <div class="form-group row pb-2">
                  <div class="col"> 
                    <div class="input-group form-row">
                      <div role="button" class="input-group-text rounded rounded-0 rounded-start col-auto btn btn-secondary">Pick Chroma Color
                        <BsTooltip class="d-inline colorpicker" @triggerEvents="click" role="presentation" as |tt|>
                          <Picker
                            role="presentation"
                            @color={{this.globalConfig.config.chromaColor}}
                            @onDone={{fn this.changeColor tt.close}}
                            @onClose={{fn this.changeColor tt.close}}
                            @popup={{false}}
                            @editor={{true}}
                            class="d-inline"
                           />                
                        </BsTooltip>
                      </div>
                      <div class="px-3 pickedColor rounded-0 col-auto"></div> 
                      <form.element @controlType="text" @formLayout="inline" class="col" @property="chromaColor" required  as |el|>
                        <el.control class="form-control rounded-0 rounded-end" />
                      </form.element>
                    </div>
                  </div>
                </div>
                <form.element @controlType="number" @formLayout="inline" class="w-100" @label="Number of elements" placeholder="5" @property="overlayLength" required />
              {{/if}}
              {{#if (eq this.globalConfig.config.overlayType "window")}}
                <div class="form-group row pb-2">
                  <div class="col"> 
                    <div class="input-group form-row">
                      <div role="button" class="input-group-text rounded rounded-0 rounded-start col-auto btn btn-secondary">Pick Chroma Color
                        <BsTooltip class="d-inline colorpicker" @triggerEvents="click" role="presentation" as |tt|>
                          <Picker
                            role="presentation"
                            @color={{this.globalConfig.config.chromaColor}}
                            @onDone={{fn this.changeColor tt.close}}
                            @onClose={{fn this.changeColor tt.close}}
                            @popup={{false}}
                            @editor={{true}}
                            class="d-inline"
                           />                
                        </BsTooltip>
                      </div>
                      <div class="px-3 pickedColor rounded-0 col-auto"></div> 
                      <form.element @controlType="text" @formLayout="inline" class="col" @property="chromaColor" required  as |el|>
                        <el.control class="form-control rounded-0 rounded-end" />
                      </form.element>
                    </div>
                  </div>
                  <div class="col-auto">
                    <form.element @controlType="checkbox" @label="Show on start" @formLayout="inline" class="form-check form-check-inline ps-0 mb-0 pt-2" @property="showOverlay" required />
                  </div>
                </div>
                <form.element @controlType="number" @formLayout="inline" class="w-100" @label="Number of elements" placeholder="5" @property="overlayLength" required />
              {{/if}}
            </div>
          </div>
          
          <div class="form-group row">
            <div class="col"><hr></div>
          </div>
          <div class="d-block pb-2 h-5">Timers settings:</div>
          <div class="form-group row pb-2">
            <label class="control-label col-form-label col-md-4">Chat lines between</label>    
            <div class="col-sm">
              <div class="input-group bg-light border rounded">
                <form.element @controlType="range" @formLayout="inline" class="w-75" @property="timerLines"  as |el|>
                  <el.control class="ember-text-field slider border-0" min="1" max="100" />
                </form.element>
                <form.element @controlType="text" @formLayout="inline" class="w-25" @property="timerLines" as |el|>
                  <el.control class="form-control border-0 bg-white" disabled={{true}} />
                </form.element>
              </div>
            </div>
          </div>  
          <div class="form-group row pb-2">
            <label class="control-label col-form-label col-md-4">Time between (minutes)</label>    
            <div class="col-sm">       
              <div class="input-group bg-light border rounded">
                <form.element @controlType="range" @formLayout="inline" class="w-75" @property="timerTime"  as |el|>
                  <el.control class="ember-text-field slider border-0" min="0" max="60" />
                </form.element>
                <form.element @controlType="text" @formLayout="inline" class="w-25"@property="timerTime" as |el|>
                  <el.control class="form-control border-0 bg-white" disabled={{true}}  />
                </form.element>
              </div>
            </div>
          </div>           
          <div class="form-group row">
            <div class="col"><hr></div>
          </div>
          <div class="form-group row">
            <label class="col-md-4 pb-2">Aditional settings</label>
          </div>
          <div class="form-group row">
            <div class="col-md-4 col-lg-auto">
              <div class="form-group row">
                <div class="col-sm">
                  <form.element @controlType="checkbox" @label="Show lyrics on start" @formLayout="inline" class="form-check form-check-inline ps-0" @property="showLyrics" required />
                </div>
              </div> 
              <div class="form-group row">
                <div class="col-sm">
                  <form.element @controlType="checkbox" @label="Dark mode" @onChange={{this.lightControl.toggleMode}} @formLayout="inline" class="form-check form-check-inline ps-0" @property="darkmode" required />
                </div>
              </div>
            </div>
            <div class="col-md-4 col-lg">
              <div class="form-group row">
                <div class="col-sm">
                  <form.element @controlType="checkbox" @label="Clear requests/setlist on app restart" @formLayout="inline" class="form-check form-check-inline ps-0" @property="clearRequests" required />
                </div>
              </div>
              <div class="form-group row">
                <div class="col-sm">
                  <form.element @controlType="checkbox" @label="Allow repeat song request" @formLayout="inline" class="form-check form-check-inline ps-0" @property="allowDuplicated" required />
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group row">
                <div class="col-sm">
                  <form.element @controlType="checkbox" @label="Allow sound commands to overlap" @formLayout="inline" class="form-check form-check-inline ps-0" @property="soundOverlap" required />
                </div>
              </div>
            </div>
          </div>
            <p class="py-0 my-0">Online backup:</p>          
            <div class="row py-2">
              <div class="col">
                <div class="input-group input-group-sm">
                  <div class="input-group-text border-default"><FaIcon @icon="link" @size="sm" /></div>
                  <Input class={{if this.cloudState.cloudError "form-control is-invalid" "form-control"}} @value={{this.globalConfig.config.remoteUrl}} aria-label="Hour cost" @type="text" placeholder="Enter remote url" />
                </div>
              </div>
            </div> 
            <div class="row pt-2 pb-4">
              <div class="col">
                <div class="input-group input-group-sm">
                  <div class="input-group-text border-default"><FaIcon @icon="user" @size="sm" /></div>
                  <Input class={{if this.cloudState.cloudError "form-control is-invalid" "form-control"}} @value={{this.globalConfig.config.username}} aria-label="Overtime hour cost" @type="text" placeholder="Enter remote username" />
                </div>
              </div>
              <div class="col">
                <div class="input-group input-group-sm">
                  <div class="input-group-text border-default"><FaIcon @icon="key" @size="sm" /></div>
                  <Input class={{if this.cloudState.cloudError "form-control is-invalid" "form-control"}} @value={{this.globalConfig.config.password}} aria-label="Emergency cost" @type="password" placeholder="Enter remote password" />
                </div>
              </div>
            </div>
            {{#if this.cloudState.cloudError}}
              <div class="row">
                <div class="col">
                  {{#if this.cloudState.connectionError}}
                    <div class="alert alert-danger py-0 px-2"><small>The connection to the server failed. Check url and login credentials.</small></div>
                  {{/if}}
                  {{#if this.cloudState.couchError}}
                    <div class="alert alert-danger py-0 px-2"><small>You connected to the server but the database doest not exist. Check database name.</small></div>
                  {{/if}}
                </div>
              </div>
            {{/if}}
          
        </BsForm>
      </Modal.body>
      <Modal.footer class="py-2 row g-0">
        <div class="col">
          <button class="btn btn-sm btn-secondary" type="button" {{on "click" @handleExport}}>Export Database</button>
          {{#let (file-queue name="uploadfile" onFileAdded=@handleImport) as |queue|}}
            <label role="button" for="upload-backup" class="btn btn-sm btn-secondary">Import Database</label>  
            <input
              type="file"
              id="upload-backup"
              accept="file/json"
              class="p-0 m-0"
              hidden
              multiple
              {{queue.selectFile}}
            >
          {{/let}}
          <button class="btn btn-sm btn-danger" type="button" {{on "click" @wipeDatabase}}>Wipe DB</button>
        </div>
        <div class="col-auto">
          <BsButton @type="success" @onClick={{this.doneEditing}}> 
            {{#if this.saving}}
              <span><FaIcon @icon="spinner" class="spin" /> Saving...</span>
            {{else}}
              <span class="pe-3 me-1"><FaIcon @icon="save" /> Save</span>
            {{/if}}
          </BsButton>
        </div>
      </Modal.footer>
    </BsModal>
{{/if}}